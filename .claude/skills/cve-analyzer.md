---
name: cve-analyzer
description: Comprehensive CVE analysis with multi-source enrichment and crown jewel correlation
version: 1.0
---

# CVE Intelligence Analyzer Skill

## Purpose
High-performance CVE analysis that fetches data from multiple authoritative sources in parallel, enriches with threat intelligence, and correlates with organizational assets to provide actionable risk assessments.

## Capabilities
- Parallel data fetching from NVD, EPSS, CISA KEV databases
- Comprehensive CVE enrichment and validation
- Crown jewel impact correlation
- Exploit prediction and active exploitation detection
- Remediation priority scoring
- Vendor advisory aggregation
- Threat actor campaign attribution

## Input Schema

```json
{
  "cve_id": "string (CVE-YYYY-NNNNN format, flexible parsing)",
  "enrichment_level": "basic|standard|comprehensive (default: standard)",
  "context": {
    "crown_jewels": ["array of crown jewel systems from user-preferences.json"],
    "technology_stack": ["array of technologies/products"],
    "industry": "string (from user profile)",
    "asset_exposure": "internet-facing|internal|cloud|hybrid"
  },
  "options": {
    "check_cache_first": "boolean (default: true)",
    "include_vendor_advisories": "boolean (default: true)",
    "include_threat_intel": "boolean (default: true)",
    "calculate_priority": "boolean (default: true)"
  }
}
```

## Output Schema

```json
{
  "status": "success|not_found|error",
  "cve_id": "string (normalized CVE-YYYY-NNNNN)",
  "analysis_timestamp": "ISO 8601 UTC",
  "processing_time_ms": "number",

  "vulnerability_overview": {
    "title": "string",
    "description": "string (detailed)",
    "published_date": "ISO 8601",
    "last_modified_date": "ISO 8601",
    "affected_products": [
      {
        "vendor": "string",
        "product": "string",
        "versions": ["array of affected versions"]
      }
    ],
    "cwe_categories": [
      {
        "cwe_id": "CWE-XXX",
        "name": "string",
        "description": "string"
      }
    ]
  },

  "risk_metrics": {
    "cvss_v3": {
      "base_score": "number (0.0-10.0)",
      "severity": "NONE|LOW|MEDIUM|HIGH|CRITICAL",
      "vector_string": "string (CVSS:3.1/AV:N/AC:L/...)",
      "attack_vector": "NETWORK|ADJACENT|LOCAL|PHYSICAL",
      "attack_complexity": "LOW|HIGH",
      "privileges_required": "NONE|LOW|HIGH",
      "user_interaction": "NONE|REQUIRED",
      "scope": "UNCHANGED|CHANGED",
      "confidentiality_impact": "NONE|LOW|HIGH",
      "integrity_impact": "NONE|LOW|HIGH",
      "availability_impact": "NONE|LOW|HIGH"
    },
    "cvss_v2": {
      "base_score": "number (optional)",
      "vector_string": "string (optional)"
    },
    "epss": {
      "score": "number (0.0-1.0, probability of exploitation)",
      "percentile": "number (0.0-1.0)",
      "date": "ISO 8601 (EPSS model date)"
    },
    "ssvc": {
      "exploitation": "none|poc|active",
      "automatable": "yes|no",
      "technical_impact": "partial|total",
      "decision": "string (track|attend|act)"
    }
  },

  "exploitation_intelligence": {
    "kev_listed": "boolean",
    "kev_date_added": "ISO 8601 (if listed)",
    "kev_due_date": "ISO 8601 (if listed)",
    "kev_required_action": "string (if listed)",
    "exploitation_status": "none|poc|itw|widespread",
    "exploit_availability": {
      "public_exploits": "boolean",
      "exploit_sources": ["ExploitDB", "GitHub", "Metasploit"],
      "exploit_maturity": "unproven|proof-of-concept|functional|high"
    },
    "active_campaigns": [
      {
        "campaign_name": "string",
        "threat_actors": ["array of threat actor names"],
        "first_observed": "ISO 8601",
        "targeting": ["industries or regions"]
      }
    ]
  },

  "organizational_impact": {
    "crown_jewel_impact": [
      {
        "crown_jewel": "string (name of affected system)",
        "confidence": "high|medium|low",
        "reasoning": "string (why this CVE affects this asset)",
        "affected_component": "string (specific technology match)"
      }
    ],
    "industry_relevance": {
      "relevant": "boolean",
      "reasoning": "string",
      "industry_specific_risks": ["array of specific risks"]
    },
    "business_impact": {
      "severity": "critical|high|medium|low",
      "potential_consequences": ["data breach", "service disruption", "..."],
      "estimated_remediation_effort": "hours|days|weeks",
      "compliance_implications": ["HIPAA", "PCI-DSS", "..."]
    },
    "priority_score": {
      "score": "number (0-100)",
      "priority_level": "P0|P1|P2|P3|P4",
      "factors": {
        "cvss_weight": "number",
        "epss_weight": "number",
        "kev_weight": "number",
        "crown_jewel_weight": "number",
        "exploitation_weight": "number"
      },
      "recommended_timeline": "immediate|24h|48h|1week|2weeks|planned"
    }
  },

  "remediation": {
    "patches_available": "boolean",
    "patch_details": [
      {
        "vendor": "string",
        "patch_version": "string",
        "release_date": "ISO 8601",
        "advisory_url": "string"
      }
    ],
    "workarounds": [
      {
        "description": "string",
        "effectiveness": "complete|partial|minimal",
        "complexity": "low|medium|high"
      }
    ],
    "vendor_advisories": [
      {
        "vendor": "string",
        "advisory_id": "string",
        "url": "string",
        "published_date": "ISO 8601"
      }
    ],
    "detection_guidance": [
      {
        "type": "signature|behavioral|configuration",
        "description": "string",
        "ioc_type": "string (optional)"
      }
    ]
  },

  "references": {
    "nvd_url": "string",
    "cve_org_url": "string",
    "vendor_urls": ["array of vendor advisory URLs"],
    "researcher_urls": ["array of research/blog URLs"],
    "exploit_urls": ["array of exploit references"]
  },

  "data_sources": {
    "nvd": {
      "status": "success|failed",
      "response_time_ms": "number"
    },
    "epss": {
      "status": "success|failed",
      "response_time_ms": "number"
    },
    "cisa_kev": {
      "status": "success|failed",
      "response_time_ms": "number"
    },
    "threat_cache": {
      "status": "checked",
      "found": "boolean"
    }
  }
}
```

## Processing Instructions

### Stage 1: CVE Identification & Normalization

1. **CVE ID Parsing**:
   - Accept flexible formats:
     - "CVE-2024-12345" (standard)
     - "2024-12345" (missing prefix)
     - "12345" (just number, use current year)
     - "CVE 2024 12345" (spaces)
   - Normalize to: CVE-YYYY-NNNNN
   - Validate format: Year 1999-current+1, Number 4-7 digits
   - Return error for invalid formats with examples

2. **Cache Check** (if enabled):
   - Search `data/threats-cache.json` for CVE ID
   - If found and fresh (< 24 hours old):
     - Extract existing analysis
     - Optionally re-enrich critical fields
   - If found but stale:
     - Use as baseline, refresh critical data
   - If not found:
     - Proceed with full enrichment

### Stage 2: Parallel Data Fetching (Critical Performance Optimization)

**Execute all data fetches in parallel using multiple WebFetch calls:**

1. **NVD API Fetch** (Primary CVE Data):
```
WebFetch: https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-2024-12345
Extract:
- Description, published date, last modified
- CVSS v3.1 metrics (base score, vector, breakdown)
- CVSS v2 metrics (if available)
- CWE categories
- Affected products (CPE configurations)
- References (vendor advisories, patches, exploits)
```

2. **EPSS API Fetch** (Exploit Prediction):
```
WebFetch: https://api.first.org/data/v1/epss?cve=CVE-2024-12345
Extract:
- EPSS score (probability 0.0-1.0)
- EPSS percentile
- Model date
```

3. **CISA KEV Check** (Active Exploitation):
```
WebFetch: https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json
Search for CVE-2024-12345 in vulnerabilities array
Extract if found:
- Date added to KEV
- Due date for remediation
- Required action
- Known ransomware campaign use
```

4. **Threat Cache Search** (Local Intelligence):
```
Read: data/threats-cache.json
Search for CVE-2024-12345 in all threat items
Extract:
- Recent mentions in threat feeds
- Associated threat actors
- Campaign information
- Industry-specific targeting
```

**Performance Target**: All 4 fetches complete in 2-5 seconds (parallel execution)

### Stage 3: Enrichment & Analysis

1. **CVSS Analysis**:
   - Parse CVSS vector string
   - Extract individual metric scores
   - Calculate exploitability subscore
   - Calculate impact subscore
   - Determine severity label
   - Generate human-readable severity explanation

2. **Exploitation Assessment**:
   - Combine EPSS + KEV + threat intel:
     - EPSS â‰¥ 0.70: High exploitation probability
     - KEV listed: Confirmed active exploitation
     - Threat intel mentions: Campaign evidence
   - Determine exploitation status:
     - `none`: No evidence of exploitation
     - `poc`: Proof-of-concept exists
     - `itw`: In-the-wild exploitation
     - `widespread`: Widespread active exploitation
   - Search references for exploit indicators:
     - ExploitDB, GitHub, Metasploit mentions
     - Public exploit code availability

3. **Threat Actor Attribution**:
   - Search threat cache for CVE mentions
   - Extract threat actor names from reports
   - Identify attack campaigns using this CVE
   - Determine targeting (industries, regions)
   - Assess threat actor sophistication

### Stage 4: Organizational Context Analysis

1. **Crown Jewel Correlation**:
   - Load crown jewels from context input
   - Extract affected products from NVD data
   - Match products to crown jewel technologies:
     - Direct match: "Microsoft Exchange" â†’ "Email Infrastructure"
     - Technology category: "SQL Database" â†’ "Customer Database"
     - Component match: "OpenSSL" â†’ systems using OpenSSL
   - Assign confidence levels:
     - `high`: Direct product/version match
     - `medium`: Technology category match
     - `low`: Potential dependency match
   - Generate reasoning for each match

2. **Industry Relevance Assessment**:
   - Load industry from context
   - Check if CVE commonly affects this industry:
     - Healthcare: Medical devices, HIPAA-covered systems
     - Finance: Payment systems, trading platforms
     - Manufacturing: ICS/SCADA, production systems
   - Search threat intel for industry-specific targeting
   - Identify compliance implications (HIPAA, PCI-DSS, etc.)

3. **Business Impact Analysis**:
   - Assess potential consequences:
     - Confidentiality impact â†’ data breach risk
     - Integrity impact â†’ data tampering risk
     - Availability impact â†’ service disruption risk
   - Estimate remediation effort:
     - Patch available + simple deployment: hours
     - Patch available + complex deployment: days
     - No patch, workarounds available: weeks
     - No patch or workarounds: weeks+
   - Determine business severity (may differ from CVSS):
     - Critical crown jewel + active exploitation: Critical
     - Crown jewel + high CVSS: High
     - Non-critical system + low CVSS: Low

### Stage 5: Priority Scoring

Calculate priority score (0-100) using weighted factors:

```
Priority Score = (
  CVSS_normalized * 25 +
  EPSS_score * 100 * 20 +
  KEV_bonus * 30 +
  Crown_Jewel_bonus * 15 +
  Exploitation_status_bonus * 10
)

Where:
- CVSS_normalized = CVSS base score / 10
- EPSS_score = EPSS probability (0.0-1.0)
- KEV_bonus = 30 if KEV-listed, else 0
- Crown_Jewel_bonus = 15 if affects crown jewel (high confidence), 8 (medium), 3 (low), else 0
- Exploitation_status_bonus = 10 (widespread), 7 (itw), 4 (poc), 0 (none)

Priority Levels:
- P0 (90-100): Immediate action required (within hours)
- P1 (75-89): Urgent action needed (within 24 hours)
- P2 (60-74): High priority (within 48 hours)
- P3 (40-59): Medium priority (within 1 week)
- P4 (0-39): Low priority (planned remediation)
```

### Stage 6: Remediation Guidance

1. **Patch Information**:
   - Extract patch details from NVD references
   - Search vendor advisories for patch versions
   - Identify release dates
   - Provide direct download/advisory URLs

2. **Workaround Identification**:
   - Extract workarounds from vendor advisories
   - Assess effectiveness:
     - `complete`: Fully mitigates vulnerability
     - `partial`: Reduces risk but doesn't eliminate
     - `minimal`: Slightly reduces attack surface
   - Rate implementation complexity

3. **Detection Guidance**:
   - Signature-based detection:
     - Specific exploit patterns
     - Malicious payload signatures
   - Behavioral detection:
     - Unusual authentication patterns
     - Abnormal network traffic
     - Process execution anomalies
   - Configuration checks:
     - Vulnerable version detection
     - Insecure configuration identification

### Stage 7: Response Assembly

1. **Synthesize Results**:
   - Combine all enrichment data
   - Validate completeness
   - Fill defaults for missing optional fields
   - Calculate processing time

2. **Generate Human-Readable Summary**:
   - Executive summary (2-3 sentences)
   - Technical summary (bullet points)
   - Immediate action items
   - Timeline recommendations

3. **Return Structured Output**:
   - Full JSON response with all fields
   - Performance metrics (data source response times)
   - Cache update instructions (for future queries)

## Example Usage

### High-Priority Crown Jewel CVE
```
Input:
{
  "cve_id": "CVE-2024-12345",
  "context": {
    "crown_jewels": ["Customer Database", "Payment Systems"],
    "industry": "financial_services"
  }
}

Processing:
âš¡ Parallel data fetch (2.3s):
  âœ“ NVD: 1.2s
  âœ“ EPSS: 0.8s
  âœ“ CISA KEV: 1.1s
  âœ“ Threat Cache: 0.3s

Output highlights:
{
  "vulnerability_overview": {
    "title": "SQL Injection in Database Framework X",
    "cvss_v3.base_score": 9.8,
    "affected_products": ["PostgreSQL 12.x-14.x"]
  },
  "risk_metrics": {
    "epss": {"score": 0.85, "percentile": 0.96},
    "kev_listed": true
  },
  "organizational_impact": {
    "crown_jewel_impact": [
      {
        "crown_jewel": "Customer Database",
        "confidence": "high",
        "reasoning": "Affects PostgreSQL 13.2 used by Customer Database"
      }
    ],
    "priority_score": {
      "score": 95,
      "priority_level": "P0",
      "recommended_timeline": "immediate"
    }
  }
}

Result: ðŸš¨ P0 CRITICAL - Immediate action required
```

## Error Handling

### Data Source Failures
- **NVD unavailable**: Use threat cache + EPSS if available, warn user
- **EPSS unavailable**: Calculate using CVSS + KEV only, note limitation
- **KEV check fails**: Assume not KEV-listed, continue analysis
- **All sources fail**: Return cache data if available, else error with retry guidance

### Invalid CVE
- **CVE doesn't exist**: Return not_found status with suggested similar CVEs
- **Future CVE number**: Warn but attempt lookup (reserved CVEs)
- **Malformed ID**: Return error with format examples and parsing help

### Partial Data
- **Missing CVSS**: Use CVSS v2 or estimate from CWE, mark as estimated
- **No affected products**: Provide generic analysis, warn about limited crown jewel correlation
- **No remediation info**: Search vendor sites, provide generic guidance

## Integration Points

### Files Used
- **Reads from**:
  - `data/threats-cache.json` (cached threat intelligence)
  - `config/user-preferences.json` (crown jewels, industry)

- **Writes to**:
  - `data/threats-cache.json` (update with enriched CVE data)

### Command Integration
- Used by: `/cve` command
- Used by: `agents/intelligence-processor.md` (threat enrichment)
- Used by: `agents/threat-synthesizer.md` (CVE response generation)

### API Endpoints
- **NVD**: https://nvd.nist.gov/developers
- **EPSS**: https://www.first.org/epss/api
- **CISA KEV**: https://www.cisa.gov/known-exploited-vulnerabilities-catalog

## Performance Characteristics
- **Processing time**: 5-10 seconds (target), down from 30-60 seconds
- **Parallel fetching**: All external APIs called simultaneously
- **Cache hit**: 1-2 seconds (no external calls)
- **Throughput**: ~10-20 CVEs/minute with full enrichment
- **Memory**: <10MB per CVE analysis

## Quality Assurance
- **Data validation**: Verify CVSS scores, dates, formats
- **Fallback mechanisms**: Use cache when APIs fail
- **Completeness checks**: Ensure all critical fields populated
- **Accuracy**: Cross-reference multiple sources for exploitation status
- **Freshness indicators**: Include data source timestamps
